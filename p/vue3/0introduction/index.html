<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue3 + webpack 多入口最简demo - xiaodu114.github.io</title>
    <meta name="keywords" content="vuejs,vue3,webpack,多入口">
    <meta name="description" content="Vue3 + webpack 多入口最简demo">

    <script src="/p/_/js/main.js"></script>
</head>

<body>
    <!-- github访问地址：/p/vue3/0introduction/index.html -->
    <div class="blog-page">
        <h1>Vue3 + webpack 多入口</h1>
        <marked-block type="info">
            <p>写在最前面：切换npm源。</p>
            <dl>
                <dt>查看npm源地址(默认为： https://registry.npmjs.org)</dt>
                <dd>
                    <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
                        npm config get registry
                    </pre>
                </dd>
                <dt>修改源地址</dt>
                <dd>
                    <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
                        npm config set registry https://registry.npm.taobao.org
                    </pre>
                </dd>
            </dl>
        </marked-block>
        <p>这里简单的记录一下：Vue3 + webpack下的多入口demo。该demo并没有使用<inline-code>@vue/cli</inline-code>、<inline-code>Vite
            </inline-code>等，而是自己搭建的，争取做到最简。
        </p>
        <h2>最简：跑起来就行 <a href="/p/vue3/0introduction/code/introduction-1.zip" target="_blank">代码下载</a></h2>
        <p>这是第一步，仅仅是Vue3 + webpack的组合，只是弄了个多入口。没有使用单文件组件、
            <inline-code>TypeScript</inline-code>、<inline-code>Less</inline-code>等，（开发）依赖也是非必要不安装，webpack配置也是非必要不添加……
        </p>
        <h3>目录树</h3>
        <p>先看一下demo目录结构，编译前后做个对比：</p>
        <p>
            <img src="./images/1.png" width="100%">
        </p>
        <p>上面的对比图中，你可以忽略tree.txt文件，该文档中的内容是项目的目录结构也就是上图中的内容。你可以使用下面的命令生成目录结构文件：</p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
            tree /f >tree.txt
        </pre>
        <h3>示例代码</h3>
        <p>这里展示一下模块1（模块1和模块2只是1和2的区别）下的入口页面html（路径为：/src/module1/index.html）和js（路径为：/src/module1/js/index.js）：</p>
        <div ddz-class="here-need-to-handle-by-highlight-and-request-html"
            data-url="/p/vue3/0introduction/code/module1/index.html" ddz-lang="html"></div>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
import * as Vue from "vue";
Vue.createApp({
    data() {
        return {
            msg: "Hi，这里是 Vue3 + webpack 多入口 示例项目 模块1 入口页面"
        }
    }
}).mount('#vue3Module1Entry');
        </pre>
        <p>下面是 package.json</p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="json">
{
    "name": "vue3-webpack-multi-entry-demo",
    "version": "1.0.0",
    "main": "index.js",
    "license": "MIT",
    "scripts": {
        "start": "webpack --progress --watch"
    }
}              
        </pre>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
<!-- 你可以用下面的命令安装 -->
yarn add vue@next
yarn add html-webpack-plugin webpack webpack-cli -D
        </pre>
        <p>下面是 webpack.config.js</p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
// yarn add vue@next
// yarn add html-webpack-plugin webpack webpack-cli -D

const path = require('path');
const webpack = require('webpack');
const HtmlWebPack = require('html-webpack-plugin');

let multiPageConfig = [{
    entry: {
        sourcePath: "./src/module1/js/index.js",
        // entry.key中以'/'分割，最后一项是文件的名称，前面的都是目录
        targetPath: "module1/js/index"
    },
    htmlWebPack: {
        sourcePath: './src/module1/index.html',
        targetPath: 'module1/index.html'
    }
}, {
    entry: {
        sourcePath: "./src/module2/js/index.js",
        targetPath: "module2/js/index"
    },
    htmlWebPack: {
        sourcePath: './src/module2/index.html',
        targetPath: 'module2/index.html'
    }
}];

let tempModuleExportsObj = {
    mode: 'development', // production | development
    devtool: "source-map",
    entry: {},
    output: {
        filename: '[name].js',
        path: path.resolve(__dirname, './www'),
        //publicPath: '/'
        //  为了可以在github上可以浏览，这里做下面的修改
        publicPath: '/vue3/www/'
    },
    module: {
        rules: []
    },
    resolve: {
        alias: {
            //  [Vue warn]: Component provided template option but runtime compilation is not supported in this build of Vue. Configure your bundler to alias "vue" to "vue/dist/vue.esm-bundler.js". 
            'vue': 'vue/dist/vue.esm-bundler.js'
        }
    },
    plugins: [
        //  Feature flags __VUE_OPTIONS_API__, __VUE_PROD_DEVTOOLS__ are not explicitly defined. You are running the esm-bundler build of Vue, which expects these compile-time feature flags to be globally injected via the bundler config in order to get better tree-shaking in the production bundle.
        new webpack.DefinePlugin({
            __VUE_OPTIONS_API__: true,
            __VUE_PROD_DEVTOOLS__: false,
        })
    ]
};
multiPageConfig.forEach(singlePage => {
    let tempEntryObj = {};
    tempEntryObj[singlePage.entry.targetPath] = singlePage.entry.sourcePath;
    Object.assign(tempModuleExportsObj.entry, tempEntryObj);
    let tempHtmlWebPackOption = {
        inject: true,
        hash: true, //开启hash  ?[hash]
        chunks: [singlePage.entry.targetPath], //页面要引入的包
    };
    Object.assign(tempHtmlWebPackOption, {
        template: singlePage.htmlWebPack.sourcePath,
        filename: singlePage.htmlWebPack.targetPath
    });
    tempModuleExportsObj.plugins.push(new HtmlWebPack(tempHtmlWebPackOption));
});
module.exports = tempModuleExportsObj;
        </pre>
        <h2>添加单文件组件支持 <a href="/p/vue3/0introduction/code/introduction-2.zip" target="_blank">代码下载</a></h2>
        <p>先来张图看看结构的变化</p>
        <p>
            <img src="./images/2.png" width="100%">
        </p>
        <h3>新增单文件组件</h3>
        <p>既然是单文件组件，先来一个，尽量简单（路径为：/src/common/component/DisplayText.vue）：就是展示一些文本。下面是组件代码：</p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="html">
<template>
    <div
        class="display-text-container"
        :style="uStyle"
    >
        <span class="text">{{value}}</span>
    </div>
</template>
<script>
    export default {
        name: "DisplayText",
        props: {
            value: {
                type: String,
                default() {
                    return "你想写点什么……";
                },
            },
            uStyle: {
                type: Object,
            },
        },
    };
</script>
        </pre>
        <h3>两个html页面的修改</h3>
        <p>两个html页面都添加下面的内容</p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="html">
<!-- 第二版：添加的内容 -->
<hr>
<display-text></display-text>
<display-text :value="displayText" :u-style="displayTextStyle"></display-text>
        </pre>
        <h3>两个html页面对应的js的修改</h3>
        <p>对应的js文件用下面的替换（记得改一下两个页面的区别）</p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
import * as Vue from "vue";
import DisplayText from '../../common/component/DisplayText.vue';
Vue.createApp({
    data() {
        return {
            msg: "Hi，这里是 Vue3 + webpack 多入口 示例项目 模块1 入口页面",
            displayText: "再说一遍，这里是 模块1 入口页面",
            displayTextStyle: {
                fontWeight: "bold"
            }
        }
    },
    components: {
        DisplayText
    }
}).mount('#vue3Module1Entry');
        </pre>
        <h3>package.json的更改</h3>
        <p>新增<inline-code>@vue/compiler-sfc</inline-code>
            <inline-code>vue-loader@next</inline-code>两个开发依赖
        </p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
<!-- 你可以用下面的命令安装 -->
yarn add vue@next
yarn add @vue/compiler-sfc html-webpack-plugin vue-loader@next webpack webpack-cli -D
        </pre>
        <h3>webpack.config.js的更改</h3>
        <p>引入<inline-code>vue-loader</inline-code>；rules中添加vue处理；plugins中添加<inline-code>vue-loader</inline-code>插件
        </p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
// 第二版：添加的内容
const {
    VueLoaderPlugin
} = require('vue-loader');

let tempModuleExportsObj = {
    module: {
        rules: [
            // 第二版：添加的内容
            {
                test: /\.vue$/,
                use: ['vue-loader']
            }
        ]
    },
    plugins: [
        // 第二版：添加的内容
        new VueLoaderPlugin()
    ]
};
        </pre>
        <p>
            <img src="./images/3.png" width="100%">
        </p>
        <h2>LESS支持 <a href="/p/vue3/0introduction/code/introduction-3.zip" target="_blank">代码下载</a></h2>
        <p>还是先来张图看看结构的变化</p>
        <p>
            <img src="./images/4.png" width="100%">
        </p>
        <h3>单文件组件添加LESS</h3>
        <p>
            <img src="./images/5.png" width="100%">
        </p>
        <h3>页面新增LESS和JS变化</h3>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="less">
*,
*::before,
*::after {
    box-sizing: border-box;
}

html,
body {
    height: 100%;
    width: 100%;
    margin: 0;
}

#vue3Module1Entry {
    height: 100%;
    width: 100%;
    padding: 20px;
    overflow: hidden;
    color: #fff;
}
        </pre>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
<!-- 页面引入样式文件 -->
import '../css/index.less';
        </pre>
        <h3>package.json的更改</h3>
        <p>新增<inline-code>css-loader</inline-code>
            <inline-code>less</inline-code>
            <inline-code>less-loader</inline-code>
            <inline-code>style-loader</inline-code>四个开发依赖
        </p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
<!-- 你可以用下面的命令安装 -->
yarn add vue@next
yarn add @vue/compiler-sfc css-loader html-webpack-plugin less less-loader style-loader vue-loader@next webpack webpack-cli -D
        </pre>
        <h3>webpack.config.js的更改</h3>
        <p>
            <img src="./images/6.png" width="100%">
        </p>
        <h2>静态文件-图片 <a href="/p/vue3/0introduction/code/introduction-4.zip" target="_blank">代码下载</a></h2>
        <p>单文件组件引入图片、html页面引入图片、LESS样式文件引入文件……还是先来张图看看结构的变化</p>
        <p>
            <img src="./images/7.png" width="100%">
        </p>
        <p>新添加的单文件组件和一些图片就不说了，html和js也只是引入了这些……</p>
        <h3>package.json的更改</h3>
        <p>新增<inline-code>html-loader</inline-code>一个开发依赖
        </p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
<!-- 你可以用下面的命令安装 -->
yarn add vue@next
yarn add @vue/compiler-sfc css-loader html-loader html-webpack-plugin less less-loader style-loader vue-loader@next webpack webpack-cli -D
        </pre>
        <h3>webpack.config.js的更改</h3>
        <p>
            <img src="./images/8.png" width="100%">
        </p>
        <p>
            记得上次写的时候是通过<inline-code>html-loader</inline-code>和<inline-code>file-loader</inline-code>解决的，但是这次不行了……又新东西了，
        </p>
        <h2>JS转ES5<a href="/p/vue3/0introduction/code/introduction-5.zip" target="_blank">代码下载</a></h2>
        <p>转ES6在真实项目中用的太多了，之前在vue2.x的时候也弄了，但是此时按照原来的方式写出现了一些问题，最后发现竟然是<inline-code>target</inline-code>的问题
            ……还是先来张图看看结构的变化</p>
        <p>
            <img src="./images/9.png" width="100%">
        </p>
        <p>原来的vue相关的代码没有变动，只是增加了一个新的模块（module3）来测试ES5的转换。</p>
        <h3>package.json的更改</h3>
        <p>新增转ES5需要的依赖，这里有点多就不列了。有两种实现方式，在<inline-code>webpack.config.js</inline-code>中有说明。
        </p>
        <h3>webpack.config.js的更改</h3>
        <p>
            <img src="./images/10.png" width="100%">
        </p>
        <marked-block type="info">
            <p>图片中的代码对比：一些注释代码给忽略了，看详细的你可以下载代码。</p>
        </marked-block>
        <h2>抽取公共JS<a href="/p/vue3/0introduction/code/introduction-6.zip" target="_blank">代码下载</a></h2>
        <p>默认打包时将依赖和业务代码都弄到一个JS中了，看着不舒服，希望打包之后的代码也有一个清晰的结构，仅仅是为了看着舒服……看一下目录变化</p>
        <p>
            <img src="./images/11.png" width="100%">
        </p>
        <h3>html和js的更改</h3>
        <p>自己整理的一些通用JS方法，放到了utils.js中。三个入口页面都引入其中的某个方法并使用……</p>
        <h3>package.json的更改</h3>
        <p>这次并没有添加新的依赖，上图中的变化是版本的升级。</p>
        <h3>webpack.config.js的更改</h3>
        <p>
            webpack.config.js添加下面的配置型
        </p>
        <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="json">
            <!-- 页面引入样式文件 -->
{
    optimization: { // 优化项
        splitChunks: { //分割代码块
            cacheGroups: { // 缓存
                'my': { // 自己整理的通用方法
                    priority: 100,
                    name: "common/js/common", // 以'/'分割，最后一项是文件的名称，前面的都是目录
                    test: /[\\/]src[\\/](common)[\\/]/,
                    chunks: 'initial',
                    minSize: 0,
                    minChunks: 1,
                    filename: '[name].js'
                },
                'core-js': { // 抽取第三方模块：core-js
                    priority: 10,
                    name: 'core-js',
                    test: /[\\/]node_modules[\\/](core-js)[\\/]/,
                    chunks: 'initial',
                    minSize: 0,
                    minChunks: 1,
                    filename: 'lib/[name]/[name].js'
                },
                'vue': { // 抽取第三方模块：vue
                    priority: 9,
                    name: 'vue',
                    test: /[\\/]node_modules[\\/](@vue|vue|vue-loader)[\\/]/,
                    chunks: 'initial',
                    minSize: 0,
                    minChunks: 1,
                    filename: 'lib/[name]/[name].js'
                },
                'other': { // 公共的代码
                    priority: 8,
                    name: "other",
                    chunks: 'initial',
                    minSize: 0,
                    minChunks: 2, // 这个代码引用多少次才需要抽离
                    filename: 'lib/[name]/[name].js'
                }
            }
        }
    }
}            
        </pre>
    </div>
</body>

</html>