<!DOCTYPE html>
<html lang="zh-cmn-Hans">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>CosyVoice - xiaodu114.github.io</title>
        <meta name="keywords" content="xiaodu114,CosyVoice,tts,æ–‡æœ¬è½¬è¯­éŸ³,å£°éŸ³å…‹éš†" />
        <meta name="description" content="æˆ‘å’Œ SenseVoice çš„æ•…äº‹ã€‚Multi-lingual large voice generation model, providing inference, training and deployment full-stack ability." />

        <script src="/p/_/js/main.js"></script>
    </head>

    <body>
        <!-- githubè®¿é—®åœ°å€ï¼š/p/mllm/cosyVoice/index.html -->
        <div class="blog-page">
            <h1>CosyVoice</h1>
            <p>GitHubï¼š<a href="https://github.com/FunAudioLLM/CosyVoice" target="_blank" rel="noopener noreferrer">FunAudioLLM/CosyVoice: Multi-lingual large voice generation model, providing inference, training and deployment full-stack ability.</a></p>
            <h2>ä¸‹è½½æ¨¡å‹</h2>
            <p>æå‰ä¸‹è½½å¥½éœ€è¦çš„æ¨¡å‹ï¼Œè¿™é‡Œçš„ä¸‹è½½è·¯å¾„æ˜¯<line-code>E:\llm\pretrained_models</line-code></p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
# gitæ¨¡å‹ä¸‹è½½ï¼Œè¯·ç¡®ä¿å·²å®‰è£…git lfs
mkdir -p pretrained_models
git clone https://www.modelscope.cn/iic/CosyVoice2-0.5B.git pretrained_models/CosyVoice2-0.5B
git clone https://www.modelscope.cn/iic/CosyVoice-300M.git pretrained_models/CosyVoice-300M
git clone https://www.modelscope.cn/iic/CosyVoice-300M-25Hz.git pretrained_models/CosyVoice-300M-25Hz
git clone https://www.modelscope.cn/iic/CosyVoice-300M-SFT.git pretrained_models/CosyVoice-300M-SFT
git clone https://www.modelscope.cn/iic/CosyVoice-300M-Instruct.git pretrained_models/CosyVoice-300M-Instruct
git clone https://www.modelscope.cn/iic/CosyVoice-ttsfrd.git pretrained_models/CosyVoice-ttsfrd
            </pre>
            <h2>windows</h2>
            <p>è¿™æ˜¯å’Œ<line-code>CosyVoice</line-code>çº¦ä¼šçš„ç¬¬ä¸€ä¸ªåœ°æ–¹</p>
            <h3>è¸©å‘</h3>
            <p>çœ‹äº†å®˜æ–¹çš„éƒ¨ç½²è¯´æ˜ä¹‹åï¼Œè§‰å¾—å°æ„æ€ï¼Œæ²¡æœ‰<line-code>conda</line-code>ä¹Ÿæ²¡é—®é¢˜ï¼Œå’±æœ‰<line-code>pip</line-code>å•Šï¼å“ï¼Œä¸å¬åŠå•Šï¼Œè´¹ç”¨è‡ªå·±æŠ˜è…¾â€¦â€¦ä½ è¯´ä½ è·‘èµ·æ¥äº†ä¹Ÿè¡Œå•Šï¼Œç»“æœå‡ºç°äº†ä¸€å †é”™è¯¯ï¼Œè¿˜è§£å†³ä¸äº†ã€‚æ’äº†å—å¢™å°±çŸ¥é“å›å¤´äº†</p>
            <p>
                <img src="./image/1.png" alt="CosyVoice é¡¹ç›®ï¼Œpip åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–" />
            </p>
            <p>
                <img src="./image/2.png" alt="CosyVoice é¡¹ç›®ï¼Œpip å®‰è£…ä¾èµ–æŠ¥é”™ï¼šModuleNotFoundError:No module named Cython" />
            </p>
            <p><line-code>ModuleNotFoundError:No module named Cython</line-code>è¿™ä¸ªé”™è¯¯å¤ªç‰›é€¼äº†ï¼Œå°è¯•äº†å„ç§åŠæ³•æ²¡æœ‰è§£å†³ï¼Œç”šè‡³è¿˜å°è¯•äº†<a href="https://github.com/astral-sh/uv/" target="_blank" rel="noopener noreferrer">astral-sh/uv: An extremely fast Python package and project manager, written in Rust.</a>æœ€åä¸å¾—ä¸å‘<line-code>conda</line-code>ä½å¤´å•Šã€‚å¦‚ä½•å®‰è£…<line-code>conda</line-code>ä½ å¯ä»¥å‚è€ƒè¿™ä¸ªï¼š<a href="/p/python/index.html" target="_blank" rel="noopener noreferrer">Python - xiaodu114.github.io</a></p>
            <h3>å…‹éš†é¡¹ç›®</h3>
            <p><line-code>2024-12-18</line-code>å…‹éš†çš„é¡¹ç›®ï¼Œæ­¤æ—¶å·²æ˜¯ 2.0 ç‰ˆæœ¬äº†ã€‚è¿™é‡Œå°†é¡¹ç›®æ”¾åˆ°äº†<line-code>F:\mllm</line-code>ç›®å½•ä¸‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
            <p>
                <img src="./image/3.png" alt="CosyVoice é¡¹ç›®ï¼Œgit å…‹éš†é¡¹ç›®" />
            </p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
git clone --recursive https://github.com/FunAudioLLM/CosyVoice.git

#   è¯¥é¡¹ç›®ä¾èµ–å­æ¨¡å— Matcha-TTSï¼Œä¿è¯å·²ç»å…‹éš†ä¸‹æ¥ï¼Œå¦‚æœä¸Šé¢æ²¡æœ‰å…‹éš†ä¸‹æ¥ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤
cd CosyVoice
git submodule update --init --recursive 
            </pre>
            <h3>è™šæ‹Ÿç¯å¢ƒ/å®‰è£…ä¾èµ–</h3>
            <p>æ³¨æ„å•Šï¼æ³¨æ„å•Šï¼æ³¨æ„å•Šï¼è¿™é‡Œç”¨çš„<line-code>conda</line-code>åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒã€‚è¿˜æ˜¯å¾—å¬è¯ï¼Œè€è€å®å®æŒ‰ç…§å®˜ç½‘ä¸Šå¼„ï¼Œå°±æ˜¯çˆ½å•Šï¼Œä¸€è·¯é¡ºé£ï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»ã€å®‰è£…ä¾èµ–éƒ½æ˜¯ä¸€æ­¥åˆ°ä½ï¼Œæ²¡æœ‰å‡ºç°ä»»åŠ¡å’Œé—®é¢˜ã€‚</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
conda create -n cosyvoice python=3.10
conda activate cosyvoice
# pynini is required by WeTextProcessing, use conda to install it as it can be executed on all platform.
conda install -y -c conda-forge pynini==2.1.5
pip install -r requirements.txt 
            </pre>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹</summary>
                <p>
                    <img src="./image/4.png" alt="CosyVoice é¡¹ç›®ï¼Œconda åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ" />
                </p>
                <p>
                    <img src="./image/5.png" alt="CosyVoice é¡¹ç›®ï¼Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£… pynini" />
                </p>
                <p>
                    <img src="./image/6.png" alt="CosyVoice é¡¹ç›®ï¼Œå®‰è£…ä¾èµ–" />
                </p>
                <p>
                    <img src="./image/7.png" alt="CosyVoice é¡¹ç›®ï¼Œå®‰è£…ä¾èµ–æˆåŠŸ" />
                </p>
            </details>
            <h3>è¿è¡Œé¡¹ç›®-WebUI</h3>
            <p>ç¯å¢ƒå’Œæ¨¡å‹éƒ½å¼„å¥½äº†ï¼Œä¸‹é¢å°±æ˜¯å¯åŠ¨é¡¹ç›®äº†ï¼Œè¿™é‡Œç”¨çš„æ˜¯<line-code>CosyVoice2-0.5B</line-code>çš„æ¨¡å‹ã€‚é€šå¾€æˆåŠŸçš„é“è·¯ä¸Šï¼Œæ°¸è¿œå°‘ä¸äº†ç£•ç£•ç»Šç»Šï¼Œè¿™ä¸é—®é¢˜åˆæ¥äº†ï¼š</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
python webui.py --model_dir "E:/llm/pretrained_models/CosyVoice2-0.5B"
            </pre>
            <p>
                <img src="./image/8.png" alt="CosyVoice é¡¹ç›®ï¼Œå¯åŠ¨å¤±è´¥ï¼Œç¼ºå°‘ä¾èµ–ï¼šonnxruntime" />
            </p>
            <p>è¿™ä¸ªé—®é¢˜è¿˜å¥½å¤„ç†ï¼Œç›´æ¥å®‰è£…ä¸€ä¸‹å°±è¡Œäº†ã€‚ä¸è¿‡ç–‘é—®çš„æ˜¯<line-code>requirements.txt</line-code>æ–‡ä»¶ä¸­æœ‰è¿™ä¸ªä¾èµ–é¡¹ï¼Œä¹‹ä¸é”™ä»–æ˜¯è¿™æ ·å†™çš„<line-code>onnxruntime==1.18.0; sys_platform == 'darwin' or sys_platform == 'windows'</line-code>ã€‚ç½‘ä¸Šæœ‰çš„è¯´åªä¿ç•™<line-code>onnxruntime==1.18.0;</line-code>å³å¯ã€‚è¿™é‡Œæ˜¯åé¢è¡¥å……å®‰è£…çš„ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰é—®é¢˜</p>
            <p>
                <img src="./image/9.png" alt="CosyVoice é¡¹ç›®ï¼Œåè¡¥å®‰è£… onnxruntime" />
            </p>
            <p>æå®šåï¼Œå†æ¬¡å¯åŠ¨é¡¹ç›®ï¼Œçœ‹çœ‹è¿™æ¬¡çš„æ•ˆæœï¼š</p>
            <p>
                <img src="./image/10.png" alt="CosyVoice é¡¹ç›®ï¼Œå¯åŠ¨æˆåŠŸ" />
            </p>
            <p>
                <img src="./image/11.png" alt="CosyVoice é¡¹ç›®ï¼Œå¯åŠ¨æˆåŠŸï¼Œæµè§ˆå™¨æˆªå›¾" />
            </p>
            <h4>æµ‹è¯•é¡¹ç›®</h4>
            <h5>3sæé€Ÿå¤åˆ»</h5>
            <p>å¯¹è¿™ä¸ªæ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå…ˆå°è¯•è¿™ä¸ªã€‚éœ€è¦å¤åˆ»ï¼ˆæˆ–è€…è¯´åˆæˆï¼‰çš„æ–‡æœ¬æ—¶<line-code>ç›®å…‰æ‰€è‡³çš†ä¸ºåå¤ï¼Œäº”æ˜Ÿé—ªè€€çš†ä¸ºä¿¡ä»°ã€‚</line-code>æºéŸ³é¢‘æ˜¯æˆ‘åœ¨é¡µé¢ä¸­ç›´æ¥å½•åˆ¶çš„</p>
            <p>
                <img src="./image/12.png" alt="CosyVoice é¡¹ç›®ï¼Œå¯åŠ¨æˆåŠŸï¼Œæµ‹è¯•3sæé€Ÿå¤åˆ»" />
            </p>
            <p>
                <img src="./image/13.png" alt="CosyVoice é¡¹ç›®ï¼Œå¯åŠ¨æˆåŠŸï¼Œæµ‹è¯•3sæé€Ÿå¤åˆ»ï¼Œå¤åˆ»æˆåŠŸ" />
            </p>
            <p>è™½ç„¶å’±çš„è€ç”µè„‘æœ‰ç‚¹æ…¢ï¼Œä½†è¿˜æ˜¯æˆåŠŸäº†ï¼Œå¹¶ä¸”æ„Ÿè§‰è¿˜æŒºåƒï¼Œéå¸¸æ»¡æ„â€¦â€¦çœŸæ˜¯ä¸ç¦å¤¸å•Šï¼æƒ³ç€æŠŠå½•åˆ¶çš„æºéŸ³é¢‘å’Œå¤åˆ»ä¹‹åçš„éŸ³é¢‘ä¸‹è½½ä¸‹æ¥ï¼Œç»“æœä¸‹è½½çš„ä¸€ä¸ª txt æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ wav æ–‡ä»¶ï¼Œä½†æ˜¯æ–‡ä»¶å¤§å°ä¸º 0 ã€‚ğŸ˜µğŸ˜µğŸ˜µ</p>
            <p>
                <img src="./image/14.png" alt="CosyVoice é¡¹ç›®ï¼Œå¯åŠ¨æˆåŠŸï¼Œæµ‹è¯•3sæé€Ÿå¤åˆ»ï¼Œå¤åˆ»æˆåŠŸï¼Œä¸‹è½½æ–‡ä»¶" />
            </p>
            <p>äºæ˜¯å°±è‡ªå·±çœ‹äº†ä¸€ä¸‹æºç ï¼Œå¿ƒæƒ³ï¼šæ—¢ç„¶ä¸‹è½½ä¸ä¸‹æ¥ï¼Œæˆ‘å°±è‡ªå·±ä¿å­˜ä¸‹æ¥ï¼Œä¸´æ—¶æ•‘æ•‘åœºã€‚å¦‚ä¸‹ï¼š</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
#   è¿™é‡Œæ˜¯è‡ªå·±æ·»åŠ çš„ä»£ç 
from datetime import datetime
source_audio_filename = 'source_' + datetime.now().strftime('%Y-%m-%d %H-%M-%S-%f')[:-3] + '.wav'
clone_audio_filename = 'clone_' + datetime.now().strftime('%Y-%m-%d %H-%M-%S-%f')[:-3] + '.wav'
prompt_wav_loaded = load_wav(prompt_wav, prompt_sr)
torchaudio.save(source_audio_filename, prompt_wav_loaded, prompt_sr) 

#   æ³¨æ„ä»£ç çš„ä½ç½®
torchaudio.save(clone_audio_filename, i['tts_speech'], cosyvoice.sample_rate)
            </pre>
            <p>
                <img src="./image/15.png" alt="CosyVoice é¡¹ç›®ï¼Œä¿®æ”¹ä»£ç ï¼Œä¸ºä¿å­˜æºéŸ³é¢‘å’Œå¤åˆ»éŸ³é¢‘" />
            </p>
            <p>è¿›è¡Œçš„è¿˜æŒºé¡ºåˆ©çš„ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
            <p>
                <img src="./image/16.png" alt="CosyVoice é¡¹ç›®ï¼Œä¿®æ”¹ä»£ç ï¼Œé‡æ–°å¯åŠ¨ä¹‹åï¼ŒæˆåŠŸä¿å­˜æºéŸ³é¢‘å’Œå¤åˆ»éŸ³é¢‘" />
            </p>
            <div style="display: flex; justify-content: space-between">
                <div>
                    <div>å½•åˆ¶çš„æºéŸ³é¢‘ï¼š</div>
                    <audio src="./audio/source_2024-12-17 18-04-16-192.wav" controls="controls"></audio>
                </div>
                <div>
                    <div>å…‹éš†çš„éŸ³é¢‘ï¼š</div>
                    <audio src="./audio/clone_2024-12-17 18-04-16-192.wav" controls="controls"></audio>
                </div>
            </div>
            <h3>è¿è¡Œé¡¹ç›®-API</h3>
            <p>WebUI ä¸æ˜¯æˆ‘ä»¬çš„ç»ˆç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ APIï¼Œä½†æ˜¯<line-code>runtime\python\fastapi\server.py</line-code>ä»…æ”¯æŒ 1.0ã€‚æˆ‘ä»¬è‡ªå·±å¼„ä¸€ä¸ªå§ï¼Œä¸æ˜¯å¾ˆéº»çƒ¦ï¼š</p>
            <p>å…ˆçœ‹ä¸€ä¸‹ç±»åº“æ–¹å¼ä½¿ç”¨çš„ç®€å•ç¤ºä¾‹ï¼š</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="bash">
import os
import sys
from cosyvoice.cli.cosyvoice import CosyVoice2
from cosyvoice.utils.file_utils import load_wav
import torchaudio

ROOT_DIR = os.path.dirname(os.path.abspath(__file__))
sys.path.append('{}/third_party/Matcha-TTS'.format(ROOT_DIR))

if __name__ == "__main__":
    tts_text = "æˆ‘ä»¬ç”Ÿåœ¨çº¢æ——ä¸‹ï¼Œé•¿åœ¨æ˜¥é£é‡Œï¼Œäººæ°‘æœ‰ä¿¡ä»°ï¼Œå›½å®¶æœ‰åŠ›é‡ï¼Œæ°‘æ—æœ‰å¸Œæœ›ï¼Œç›®å…‰æ‰€è‡³çš†ä¸ºåå¤ï¼Œäº”æ˜Ÿé—ªè€€ï¼Œçš†ä¸ºä¿¡ä»°ï¼Œæ„¿ä»¥å¾è¾ˆä¹‹é’æ˜¥ï¼ŒæŠ¤æˆ‘ç››ä¸–ä¹‹ä¸­å ï¼Œæ­¤ç”Ÿæ— æ‚”å…¥åå¤ï¼Œæ¥ç”Ÿè¿˜åšä¸­å›½äººï¼"
    prompt_text = "ä½ ä»Šå¤©æ™šä¸Šåƒçš„ä»€ä¹ˆé¥­å‘€"

    cosyvoice = CosyVoice2('E:/llm/pretrained_models/CosyVoice2-0.5B',load_jit=True, load_onnx=False, load_trt=False)
    prompt_speech_16k = load_wav('source_001.wav', 16000)

    for i, j in enumerate(cosyvoice.inference_zero_shot(tts_text, prompt_text, prompt_speech_16k, stream=False)):
        torchaudio.save('zero_shot_ddz_{}.wav'.format(i), j['tts_speech'], cosyvoice.sample_rate)
            </pre>
            <p>ä¸Šé¢çš„ä»£ç è·‘é€šä¹‹åï¼Œå¼€å§‹å¼„APIï¼Œå…¥å£æ–‡ä»¶ä¸º<line-code>api.py</line-code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç è¯¦æƒ…</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="./source/api.txt" ddz-lang="python"></div>
            </details>
            <p>ä¹‹åï¼Œä½ åªéœ€è¦<line-code>python api.py</line-code>å³å¯ï¼Œè®°å¾—æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå•Š</p>
            <p>
                <img src="./image/17.png" alt="CosyVoice é¡¹ç›®ï¼ŒAPI æ–¹å¼å¯åŠ¨é¡¹ç›®" />
            </p>
            <p>ä¸‹é¢å†çœ‹ä¸€ä¸‹ï¼Œåˆ©ç”¨æ¥å£æ–‡æ¡£æµ‹è¯•æ¥å£çš„æˆªå›¾ï¼š</p>
            <p>
                <img src="./image/18.png" alt="CosyVoice é¡¹ç›®ï¼ŒAPI æ–¹å¼å¯åŠ¨é¡¹ç›®ï¼Œåˆ©ç”¨æ¥å£æ–‡æ¡£æµ‹è¯•" />
            </p>
        </div>
    </body>
</html>
