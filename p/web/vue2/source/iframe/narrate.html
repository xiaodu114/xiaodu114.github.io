<!DOCTYPE html>
<html lang="zh-cmn-Hans">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>æˆ‘å’Œ Vue.js - xiaodu114.github.io</title>
        <meta name="keywords" content="Vue.js,Vue,Vue 2,è§£è¯´ Vue,Observer,Dep,Watcher,defineReactive,Object.defineProperty" />
        <meta name="description" content="ä»‹ç»ä¸€ä¸‹ Vue.js 2.x ç‰ˆæœ¬ä¸­ä¸»è¦çš„æ–¹æ³•å’Œç±»ï¼Œæˆ–è€…è¯´æˆ‘å…³æ³¨çš„æ–¹æ³•å’Œç±»" />
        <style>
            li {
                line-height: 1.8;
            }

            dl,
            dt,
            dd {
                line-height: 1.8;
            }
        </style>
        <script src="/p/_/js/main.js"></script>
    </head>

    <body>
        <div class="blog-page">
            <h1>è§£è¯´</h1>
            <p>ä»‹ç»ä¸€ä¸‹<line-code>Vue 2</line-code>ä¸­ä¸»è¦çš„æ–¹æ³•å’Œç±»ï¼Œæ›´å‡†ç¡®è¯´æ˜¯ï¼Œæˆ‘å…³æ³¨çš„æ–¹æ³•å’Œç±»</p>
            <h2>Vue.prototype._init æ–¹æ³•</h2>
            <p>åœ¨<line-code>new Vue()</line-code>æ—¶å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function Vue(options) {
    if (!(this instanceof Vue)) {
        warn$2("Vue is a constructor and should be called with the `new` keyword");
    }
    //  ddz æ·»åŠ çš„æ³¨é‡Šï¼šè°ƒç”¨åŸå‹ä¸Šçš„ _init æ–¹æ³•
    this._init(options);
}
            </pre>
            <p>ä¸‹é¢çš„ä»£ç æ‘˜è‡ª<line-code>Vue.prototype._init</line-code>ï¼Œå¦‚ä¸‹ï¼š</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šthis èµ‹å€¼ç»™äº† vm ï¼Œåé¢ä½ ä¼šç»å¸¸çœ‹åˆ°ä»–ï¼ŒçŸ¥é“ä»–æ˜¯å•¥äº†å§
var vm = this;

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šä¼šåœ¨ vm ä¸Šæ·»åŠ  _renderProxy å±æ€§ï¼Œä»–çš„å€¼ä¸º vm æˆ–è€… new Proxy(vm, {})ã€‚è¿™é‡Œçš„ Proxy æ˜¯åŸç”Ÿçš„ã€‚
initProxy(vm);

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šç”¨åˆ°æ—¶åœ¨è¯´
initLifecycle(vm);

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šç”¨åˆ°æ—¶åœ¨è¯´
initEvents(vm);

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šç”¨åˆ°æ—¶åœ¨è¯´
initRender(vm);

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šè°ƒç”¨ beforeCreate é’©å­å‡½æ•°
callHook$1(vm, "beforeCreate", undefined, false /* setContext */);

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼š
initInjections(vm); // resolve injections before data/props

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šè¯¥æ–¹æ³•ä¸­ä¼šè°ƒç”¨ initData æ–¹æ³•
initState(vm);

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šç”¨åˆ°æ—¶åœ¨è¯´
initProvide(vm); // resolve provide after data/props

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šè°ƒç”¨ created é’©å­å‡½æ•°
callHook$1(vm, "created");

//  â€¦â€¦

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šå¼€å§‹æŒ‚è½½ã€‚è¿™é‡Œè¾¹ä¼šè°ƒç”¨åˆ° mountComponent æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨ beforeMountã€mounted é’©å­å‡½æ•°ï¼Œè¿˜ä¼š new Watcher
if (vm.$options.el) {
    vm.$mount(vm.$options.el);
}
            </pre>
            <h2>initProxy æ–¹æ³•</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ initProxy æ–¹æ³•</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/initProxy.js" ddz-lang="javascript"></div>
            </details>
            <p></p>
            <mark-block explain="è§£è¯´">
                <p>è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¼šåœ¨ä¼ å…¥çš„å‚æ•°ï¼ˆè¿™é‡Œæ˜¯ vmï¼Œä¹Ÿå°±æ˜¯ Vue çš„å®ä¾‹ï¼‰vm ä¸Šæ·»åŠ  _renderProxy å±æ€§ã€‚ä¸ºå•¥è¦è¯´ä»–å‘¢ï¼Ÿåé¢è°ƒç”¨æ¸²æŸ“å‡½æ•°æ—¶è¦ç”¨åˆ°ä»–</p>
                <dl>
                    <dt>åˆ¤æ–­æ˜¯å¦æ”¯æŒåŸç”Ÿ Proxy</dt>
                    <dd>å¦‚æœæ”¯æŒï¼š<line-code>vm._renderProxy = new Proxy(vm, handlers);</line-code></dd>
                    <dd>å¦‚æœä¸æ”¯æŒï¼š<line-code>vm._renderProxy = vm;</line-code></dd>
                </dl>
            </mark-block>
            <h2>initData æ–¹æ³•</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ initData æ–¹æ³•</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/initData.js" ddz-lang="javascript"></div>
            </details>
            <p></p>
            <mark-block explain="è§£è¯´">
                <p>å…³æ³¨çš„åœ°æ–¹</p>
                <dl>
                    <dt>å°† data (å¯¹è±¡æˆ–è€…å‡½æ•°è¿”å›å€¼)æŒ‚åˆ° Vue å®ä¾‹çš„ _data å±æ€§ä¸Š</dt>
                    <dd>
                        <line-code>data = vm._data = isFunction(data) ? getData(data, vm) : data || {};</line-code>
                    </dd>
                    <dt>å°† data (å¯¹è±¡æˆ–è€…å‡½æ•°è¿”å›å€¼)ä¸­çš„å±æ€§æŒ‚åˆ° Vue å®ä¾‹ä¸Šï¼Œè¿™ä¹Ÿæ˜¯ data ä¸­çš„å±æ€§å¯ä»¥ç›´æ¥åœ¨ this ä¸­ä½¿ç”¨çš„åŸå› </dt>
                    <dd>
                        <line-code>proxy(vm, "_data", key);</line-code>
                    </dd>
                    <dt>è§‚å¯Ÿ dataï¼ˆåˆ›å»º Observerï¼Œè°ƒç”¨ defineReactive ç­‰ï¼‰</dt>
                    <dd><line-code>var ob = observe(data);</line-code></dd>
                </dl>
            </mark-block>
            <h2>proxy æ–¹æ³•</h2>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
var sharedPropertyDefinition = {
    enumerable: true,
    configurable: true,
    get: noop,
    set: noop
};
function proxy(target, sourceKey, key) {
    sharedPropertyDefinition.get = function proxyGetter() {
        return this[sourceKey][key];
    };
    sharedPropertyDefinition.set = function proxySetter(val) {
        this[sourceKey][key] = val;
    };
    Object.defineProperty(target, key, sharedPropertyDefinition);
}
            </pre>
            <p></p>
            <mark-block explain="è§£è¯´">
                <p>å°† data (å¯¹è±¡æˆ–è€…å‡½æ•°è¿”å›å€¼)ä¸­çš„å±æ€§ä»¥åŠ props æŒ‚åˆ° Vue å®ä¾‹ä¸Šï¼Œè¿™æ · data ã€ props ä¸­çš„å±æ€§å¯ä»¥ç›´æ¥åœ¨ this ä¸­ä½¿ç”¨äº†</p>
                <ul>
                    <li>
                        <line-code>proxy(vm, "_data", key);</line-code>
                    </li>
                    <li>
                        <line-code>proxy(vm, "_props", key);</line-code>
                    </li>
                    <li><line-code>proxy(Comp.prototype, "_props", key);</line-code>ï¼Œç”¨åˆ°æ—¶å†è¯´</li>
                </ul>
            </mark-block>
            <h2>Observer ç±»</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ Observer ç±»</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/Observer.js" ddz-lang="javascript"></div>
            </details>
            <p></p>
            <mark-block explain="è§£è¯´">
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  0ã€initData æ–¹æ³•ä¼šè°ƒç”¨ observe æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š
var ob = observe(data);

//  1ã€observe æ–¹æ³•è¿”å› new Observerï¼Œè¿™é‡Œçš„ value å°±æ˜¯ä½  new Vue æ—¶çš„ data (å¯¹è±¡æˆ–è€…å‡½æ•°è¿”å›å€¼) 
return new Observer(value, shallow, ssrMockReactivity);

//  2ã€Observer æ„é€ å‡½æ•°ä¸­ï¼Œéå† data å¹¶è°ƒç”¨ defineReactive ï¼ˆæš‚æ—¶åªè€ƒè™‘ç¬¬ä¸€å±‚ï¼‰
var keys = Object.keys(value);
for (var i = 0; i &lt; keys.length; i++) {
    var key = keys[i];
    defineReactive(value, key, NO_INITIAL_VALUE, undefined, shallow, mock);
}
                </pre>
            </mark-block>
            <h2>defineReactive æ–¹æ³•</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ defineReactive æ–¹æ³•</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/defineReactive.js" ddz-lang="javascript"></div>
            </details>
            <p></p>
            <mark-block explain="è§£è¯´">
                <p>é“ºå«äº†è¿™ä¹ˆå¤šï¼Œä½ æƒ³è¦çš„æ•°æ®æ‹¦æˆªç»ˆäºæ¥äº†ã€‚è¯· <line-code>Object.defineProperty</line-code> ç™»åœºï¼ŒğŸ‘ğŸ‘ğŸ‘</p>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  defineReactive æ–¹æ³•æœ€å¤–å±‚çš„ä»£ç 
var dep = new Dep();

//  get ä¸­çš„éƒ¨åˆ†ä»£ç 
if (Dep.target) {
    {
        dep.depend({
            target: obj,
            type: "get" /* TrackOpTypes.GET */,
            key: key
        });
    }
    // â€¦â€¦
}
                </pre>
                <dl>
                    <dt>1ã€Dep.target æ˜¯å•¥ï¼Ÿ</dt>
                    <dd>ä»–æ˜¯ Watcher çš„å®ä¾‹</dd>
                    <dt>2ã€ä¸ºä»€ä¹ˆåˆ¤æ–­ä»–ï¼Ÿ</dt>
                    <dd>ä»è°ƒç”¨æ ˆä¸Šå¯ä»¥çœ‹å‡ºï¼Œå°±æ˜¯ä»ä»–ä¸€è·¯â€œè¿½â€åˆ°äº†è¿™é‡Œï¼Œå’±ä»¬æ”¶é›†çš„å°±æ˜¯ä»–ã€‚</dd>
                    <dd>ä¾‹å¦‚ï¼šé¡µé¢ä¸­ä½¿ç”¨äº† data ä¸­çš„æ•°æ®ï¼ˆå½¢å¦‚ï¼š<line-code>{{msg}}</line-code>ï¼‰ï¼Œä¹‹ååœ¨é¡µé¢ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œå’±è‚¯å®šå¾—è¯»å– msg çš„å€¼å•Šï¼Œè¯»å–ä¸å°±æ˜¯ get å˜›ã€‚äºæ˜¯å°±çŸ¥é“äº†ï¼Œå“¦ï¼åŸæ¥æ˜¯ä½ è¿™ä¸ª watcher ä½¿ç”¨äº† msg å•Šï¼æˆ‘è®°ä¸‹äº†ï¼Œåé¢å¦‚æœä»–å˜äº†ï¼Œæˆ‘å‘Šè¯‰ä½ å•Š</dd>
                    <dt>3ã€è°ƒç”¨ dep.depend æ–¹æ³•æ—¶ä¹Ÿæ²¡æœ‰ä¼ å…¥ Dep.target å•Šï¼Œdep æ˜¯å¦‚ä½•æ”¶é›†çš„ï¼Ÿ</dt>
                    <dd>
                        è¿™ä¸ªè¿‡ç¨‹æ˜¯æŒºç»•çš„ï¼Œä½ å¬æˆ‘ç»™ä½ æ…¢æ…¢è®²æ¥ï¼š
                        <ol>
                            <li>get ä¸­è°ƒç”¨ dep.depend</li>
                            <li>Dep.prototype.depend æ–¹æ³•ä¸­è°ƒç”¨ Dep.target.addDep(this);ï¼ˆæ³¨æ„ï¼šDep.target æ˜¯ watcher å•Šï¼Œè°ƒç”¨æ—¶å°† dep å¼„äº†è¿›å»ï¼Œè¿™é‡Œçš„ this æ˜¯ dep ï¼‰</li>
                            <li>Watcher.prototype.addDep æ–¹æ³•ä¸­è°ƒç”¨ dep.addSub(this);ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„ this æ˜¯ watcher ï¼‰</li>
                            <li>Dep.prototype.addSub æ–¹æ³•ä¸­è°ƒç”¨ this.subs.push(sub);ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„ sub å°±æ˜¯ watcher ï¼‰</li>
                            <li>è‡³æ­¤ï¼Œdep ç»ˆäºæ”¶é›†äº† watcher</li>
                        </ol>
                    </dd>
                </dl>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  defineReactive æ–¹æ³•æœ€å¤–å±‚çš„ä»£ç 
var dep = new Dep();

//  set ä¸­çš„éƒ¨åˆ†ä»£ç 
dep.notify({
    type: "set" /* TriggerOpTypes.SET */,
    target: obj,
    key: key,
    newValue: newVal,
    oldValue: value
});
                </pre>
                <ol>
                    <li>set ä¸­è°ƒç”¨ dep.notify</li>
                    <li>Dep.prototype.notify æ–¹æ³•ä¸­éå† this.subs ï¼Œéå†ä¸­è°ƒç”¨å…¶ä¸­æ¯ä¸€é¡¹çš„ update æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ sub.update();ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„ sub ä¾¿æ˜¯ get ä¸­æ”¶é›†çš„ watcherï¼‰</li>
                    <li>
                        <span>Watcher.prototype.update æ–¹æ³•ä¸­</span>
                        <dl>
                            <dt><line-code>this.sync</line-code>ï¼ˆå¦‚æœåŒæ­¥ï¼‰</dt>
                            <dd>
                                <ol>
                                    <li>è°ƒç”¨ <line-code>this.run</line-code>ï¼ˆ Watcher.prototype.run ï¼‰ï¼Œå…¶ä¸­ä¼šè°ƒç”¨<line-code>this.get</line-code>æ–¹æ³•</li>
                                    <li>è°ƒç”¨<line-code>this.get</line-code>ï¼ˆ Watcher.prototype.get ï¼‰ï¼Œå…¶ä¸­ä¼šè°ƒç”¨<line-code>this.getter.call(vm, vm);</line-code>ï¼Œè¿™ä¸ª this.getter å°±æ˜¯ new Watcher æ—¶çš„ç¬¬äºŒä¸ªå‚æ•°</li>
                                </ol>
                            </dd>
                        </dl>
                        <dl>
                            <dt><line-code>!this.sync</line-code>ï¼ˆå¦‚æœå¼‚æ­¥ï¼‰</dt>
                            <dd>
                                <ol>
                                    <li>è°ƒç”¨<line-code>queueWatcher(this);</line-code>ï¼Œthis è‚¯å®šå°±æ˜¯ watcher äº†ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å°† watcher æ·»åŠ åˆ°<line-code>queue</line-code>æ•°ç»„ä¸­</li>
                                    <li><line-code>!config.async</line-code>ç›´æ¥è°ƒç”¨æˆ–è€…<line-code>nextTick</line-code>ä¹‹åè°ƒç”¨<line-code>flushSchedulerQueue</line-code>æ–¹æ³•åˆ·æ–°é˜Ÿåˆ—</li>
                                    <li><line-code>flushSchedulerQueue</line-code>æ–¹æ³•ä¸­ä¼šéå†<line-code>queue</line-code>æ•°ç»„ï¼Œéå†ä¸­è°ƒç”¨<line-code>watcher.run();</line-code>æ–¹æ³•</li>
                                    <li>åˆ°äº† watcher.run æ–¹æ³•å°±å’Œä¸Šé¢çš„æ­¥éª¤ä¸€æ ·äº†</li>
                                </ol>
                            </dd>
                        </dl>
                    </li>
                </ol>
            </mark-block>
            <h2>Dep ç±»</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ Dep ç±»</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/Dep.js" ddz-lang="javascript"></div>
            </details>
            <p></p>
            <mark-block explain="è§£è¯´">
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šçœŸæ­£æŠŠ watcher æ”¾åœ¨å…œé‡Œ
Dep.prototype.addSub = function (sub) {
    this.subs.push(sub);
};

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šæ”¶é›† watcher çš„å…¥å£
Dep.prototype.depend = function (info) {
    Dep.target.addDep(this);
};

//  ddz æ·»åŠ çš„æ³¨é‡Šï¼šé€šçŸ¥æ‰€æœ‰çš„ watcher ï¼šå—¨ï¼Œ msg æ›´æ–°äº†ï¼Œä½ èµ¶ç´§å¤„ç†ä¸€ä¸‹ 
Dep.prototype.notify = function (info) {
    // stabilize the subscriber list first
    var subs = this.subs.filter(function (s) {
        return s;
    });
    for (var i = 0, l = subs.length; i &lt; l; i++) {
        var sub = subs[i];
        sub.update();
    }
};
                </pre>
            </mark-block>
            <h2>Vue.prototype.$mount</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ $mount æ–¹æ³•</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/prototype$mount.js" ddz-lang="javascript"></div>
            </details>
            <p></p>
            <mark-block explain="è§£è¯´">
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//   å…ˆå¼„äº†ä¸€ä¸ª
Vue.prototype.$mount = function (el, hydrating) {
    el = el && inBrowser ? query(el) : undefined;
    return mountComponent(this, el, hydrating);
};

//   ä¿ç•™ä¸€ä¸ªåŸæ¥çš„
var mount = Vue.prototype.$mount;

//   åˆå¼„äº†ä¸€ä¸ªæ–°çš„
Vue.prototype.$mount = function (el, hydrating) {
    //â€¦â€¦
    //  è°ƒç”¨ä¹‹å‰çš„é‚£ä¸ª
    return mount.call(this, el, hydrating);
};
                </pre>
                <p>åœ¨é‡å†™çš„ $mount æ–¹æ³•ä¸­ï¼šæœ‰ renderï¼ˆoptions.renderï¼Œnew Vue æ—¶ä½ ä¼ äº†ï¼‰ ç”¨ renderï¼Œå¦‚æœæ²¡æœ‰ renderï¼Œåˆ™æ ¹æ® template åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å‡½æ•°å¹¶èµ‹å€¼ç»™ options.render</p>
                <p><strong>é‡ç‚¹å…³æ³¨ï¼š</strong>è°ƒç”¨ compileToFunctions æ–¹æ³•å°† template è½¬ä¸º render</p>
            </mark-block>
            <h2>mountComponent æ–¹æ³•</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ mountComponent æ–¹æ³•</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/mountComponent.js" ddz-lang="javascript"></div>
            </details>
            <p></p>
            <mark-block explain="è§£è¯´">
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  â€¦â€¦

//   è°ƒç”¨ beforeMount é’©å­å‡½æ•°
callHook$1(vm, "beforeMount");
var updateComponent;

//  åé¢ä¼šå°†è¿™ä¸ªæ–¹æ³•ä½œä¸º new Watcher çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ expOrFnï¼‰ï¼Œä¹‹åå°†ä»–èµ‹å€¼ç»™äº† watcher ä¸­çš„ this.getter
//      ä¹Ÿå°±æ˜¯åœ¨ watcher ä¸­è°ƒç”¨ this.getter å°±æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³• 
updateComponent = function () {
    vm._update(vm._render(), hydrating);
};

//  â€¦â€¦
//  åœ¨ Watcher æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°† vm._watcher è®¾ç½®ä¸ºè¿™ä¸ª Watcher å®ä¾‹ã€‚ä»£ç ï¼švm._watcher = this;
//  è¿˜æœ‰ä¸€æ®µè‹±æ–‡æ³¨é‡Šï¼Œç°åœ¨çœ‹ç€æœ‰ç‚¹æ‡µâ€¦â€¦
new Watcher(vm, updateComponent, noop, watcherOptions, true /* isRenderWatcher */);

//  â€¦â€¦
//   è°ƒç”¨ mounted é’©å­å‡½æ•°
callHook$1(vm, "mounted");
                </pre>
            </mark-block>
            <h2>Watcher ç±»</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ Watcher ç±»</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/Watcher.js" ddz-lang="javascript"></div>
            </details>
            <h3>æŒ‚è½½è¿‡ç¨‹ä¸­è°ƒç”¨</h3>
            <p>ä¹Ÿå°±æ˜¯<line-code>new Vue -> _init -> vm.$mount -> mountComponent -> new Watcher</line-code>è¿™ä¸ªè¿‡ç¨‹</p>
            <mark-block explain="è§£è¯´">
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  1ã€è¿™é‡Œæ˜¯ Watcher æ„é€ å‡½æ•°ä¸­çš„ä»£ç 
if (isFunction(expOrFn)) {
    this.getter = expOrFn;
}
//  æœ«å°¾è°ƒç”¨ this.get æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­ä¼šè°ƒç”¨ this.getter æ–¹æ³•
this.value = this.lazy ? undefined : this.get();

//  2ã€è¿™é‡Œæ˜¯ Watcher.prototype.get ä¸­çš„ä»£ç 
//      è¿™ä¸€æ­¥æŒºé‡è¦ï¼Œä¼šå°† thisï¼ˆ Watcher çš„å®ä¾‹ï¼‰æ·»åŠ åˆ° targetStack ä¸­ï¼Œå¹¶ä¸”å°†ä»–èµ‹å€¼ç»™ Dep.target
//      ä¸ºå•¥è¿™é‡Œè¦è¯´ä¸€ä¸‹ Dep.target ï¼Œå› ä¸ºåœ¨è°ƒç”¨æ‹¦æˆªå™¨ get æ—¶ä¼šåˆ¤æ–­ Dep.target æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œæ‰ä¼šæ”¶é›†ä¾èµ–
pushTarget(this);
//      è°ƒç”¨ this.getter ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ expOrFn æ–¹æ³•ï¼Œnew Watcher æ—¶çš„ç¬¬äºŒä¸ªå‚æ•°
value = this.getter.call(vm, vm);

//  3ã€æ³¨æ„ï¼šä¸‹é¢çš„ä»£ç å¹¶ä¸æ˜¯ Watcher ä¸­çš„ï¼Œæ”¾åœ¨è¿™é‡Œåªæ˜¯æƒ³å‘Šè¯‰ä½  expOrFn æ˜¯å•¥ã€‚ä»–å°±æ˜¯ï¼š
updateComponent = function () {
    vm._update(vm._render(), hydrating);
};
                </pre>
                <p>é€šè¿‡ä¸Šæ–‡å¯çŸ¥ï¼šåœ¨ new Watcher ä¸­è°ƒç”¨äº† updateComponent æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨ vm._render å’Œ vm._update</p>
            </mark-block>
            <h3>æ›´æ–°ä¹‹åè°ƒç”¨</h3>
            <p>ä¾‹å¦‚ï¼ŒåŒå‘ç»‘å®šçš„inputè¾“å…¥æ¡†ä¿®æ”¹ä¹‹åã€‚</p>
            <mark-block explain="è§£è¯´">
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  0ã€ä¸‹é¢çš„ä»£ç æ¥è‡ªï¼Œæ ¹æ®æ¨¡æ¿ç”Ÿæˆçš„æ¸²æŸ“å‡½æ•°
//      è§¦å‘è¾“å…¥æ¡†çš„ input äº‹ä»¶ï¼Œç»™ msg èµ‹å€¼ï¼Œä¹Ÿå°±ä¼šè°ƒç”¨ defineReactive ä¸­çš„ set
//      ä¸Šé¢è§£è¯» defineReactive ä¸­çš„ set æ—¶ï¼Œå·²ç»è®²è¿°äº†å¦‚ä½•ä¸€æ­¥æ­¥è¿½åˆ° watcher çš„ run æ–¹æ³•çš„
{
    on: {
        input: function ($event) {
            if ($event.target.composing) return;
            msg = $event.target.value;
        }
    }
}

//  1ã€è¿™é‡Œæ˜¯ Watcher.prototype.run ä¸­çš„ä»£ç 
var value = this.get(); 
                </pre>
                <p>åˆ°äº† this.get å’Œä¸Šé¢çš„é€»è¾‘å°±ä¸€æ ·äº†ï¼Œåªä¸è¿‡ä¸Šé¢æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨çš„ï¼Œè€Œè¿™é‡Œæ˜¯åœ¨ run ä¸­è°ƒç”¨çš„ã€‚</p>
            </mark-block>
            <h2>_render æ–¹æ³•</h2>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹ _render æ–¹æ³•</summary>
                <div ddz-class="here-need-to-handle-by-highlight-and-request-html" data-url="../vue/_render.js" ddz-lang="javascript"></div>
            </details>
            <p></p>
            <mark-block explain="è§£è¯´">
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  1ã€æ‹¿åˆ° render æ–¹æ³•ï¼Œnew Vue æ—¶ä½ ä¼ è¿›æ¥çš„æˆ–è€…æ ¹æ® template ç”Ÿæˆçš„
var _a = vm.$options,
    render = _a.render,
    _parentVnode = _a._parentVnode;

// â€¦â€¦

//  2ã€è°ƒç”¨ render
var vnode;
vnode = render.call(vm._renderProxy, vm.$createElement);
                </pre>
            </mark-block>
        </div>
    </body>
</html>
