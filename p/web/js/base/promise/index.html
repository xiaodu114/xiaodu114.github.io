<!DOCTYPE html>
<html lang="zh-cmn-Hans">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Promise - xiaodu114.github.io</title>
        <meta name="keywords" content="xiaodu114,Promise,æ‰‹å†™ Promise,ES5 Promise" />
        <meta name="description" content="å…³äº Promise çš„ä¸€åˆ‡ï¼Œè®¤è¯† Promise ï¼Œé‡å†™ Promise" />

        <script src="/p/_/js/main.js"></script>
    </head>

    <body>
        <!-- githubè®¿é—®åœ°å€ï¼š/p/web/js/base/promise/index.html -->
        <div class="blog-page">
            <h1>Promise</h1>
            <p><line-code>Promise</line-code>ï¼Œç¦»ä¸å¼€ï¼ŒçœŸçš„ç¦»ä¸å¼€â€¦â€¦é‚£ä»–æœ‰ä½•é­…åŠ›ï¼Œè¿˜æ˜¯å…ˆçœ‹çœ‹æƒå¨çš„è§£é‡Šå§ï¼</p>
            <ul>
                <li>
                    <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise - JavaScript | MDN</a>
                </li>
                <li>
                    <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ Promise - JavaScript | MDN</a>
                </li>
                <li>
                    <a href="https://zh.javascript.info/promise-basics" target="_blank" rel="noopener noreferrer">Promise - ç°ä»£ JavaScript æ•™ç¨‹</a>
                </li>
            </ul>
            <h2>Promises/A+</h2>
            <ul>
                <li>
                    <a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">Promises/A+</a>
                </li>
            </ul>
            <h2>Polyfill</h2>
            <ul>
                <li>
                    <a href="https://github.com/zloirock/core-js#ecmascript-promise" target="_blank" rel="noopener noreferrer">core-js ä¸­ Promise çš„ Polyfill</a>
                </li>
            </ul>
            <h2>æ‹†è§£ Promise</h2>
            <p>æ‰‹å†™ <line-code>Promise</line-code>ä¹‹åï¼Œæ„Ÿè§‰è¿™å—å„¿å°±æ²¡å•¥ç”¨äº†â€¦â€¦å…ˆæ”¾è¿™å„¿å§ï¼Œåé¢åˆ æ‰</p>
            <h3>çŠ¶æ€</h3>
            <ul>
                <li><line-code>pending</line-code>ï¼Œåˆå§‹çŠ¶æ€</li>
                <li><line-code>fulfilled</line-code>ï¼ŒæˆåŠŸçŠ¶æ€</li>
                <li><line-code>rejected</line-code>ï¼Œå¤±è´¥çŠ¶æ€</li>
            </ul>
            <mark-block>
                <p>çŠ¶æ€çš„æ”¹å˜åªèƒ½æ˜¯ä¸‹é¢çš„ä¸¤ç§æƒ…å†µï¼š</p>
                <p>ç”±<line-code>pending</line-code>åˆ°<line-code>fulfilled</line-code></p>
                <p>ç”±<line-code>pending</line-code>åˆ°<line-code>rejected</line-code></p>
            </mark-block>
            <h3>æ„é€ å‡½æ•°</h3>
            <mark-block>
                <ul>
                    <li>å‚æ•°åªæœ‰ä¸€ä¸ªï¼Œå¹¶ä¸”æ˜¯ä¸ªæ–¹æ³•ã€‚ä¹‹åä½¿ç”¨<line-code>executor</line-code>ä»£æ›¿</li>
                    <li>åœ¨<line-code>Promise</line-code>çš„<line-code>constructor</line-code>ä¸­<strong>ç«‹å³åŒæ­¥è°ƒç”¨</strong> <line-code>executor</line-code>è¿™ä¸ªæ–¹æ³•ã€‚</li>
                    <li>
                        <span>è°ƒç”¨<line-code>executor</line-code>æ–¹æ³•æ—¶ä¼ å…¥ä¸¤ä¸ªæ–¹æ³•</span>
                        <ul>
                            <li>æ–¹æ³•ä¸€ï¼šå¯ä»¥å›ä¼ æˆåŠŸçš„æ•°æ®ï¼Œä¹‹åçŠ¶æ€ç”±<line-code>pending</line-code>ä¿®æ”¹ä¸º<line-code>fulfilled</line-code></li>
                            <li>æ–¹æ³•äºŒï¼šå¯ä»¥å›ä¼ å¤±è´¥çš„æ•°æ®ï¼Œä¹‹åçŠ¶æ€ç”±<line-code>pending</line-code>ä¿®æ”¹ä¸º<line-code>rejected</line-code></li>
                        </ul>
                    </li>
                </ul>
            </mark-block>
            <h3>å®ä¾‹æ–¹æ³•</h3>
            <h4>then</h4>
            <mark-block>
                <ul>
                    <li>
                        <span>ä¸¤ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æˆåŠŸçš„å›è°ƒï¼Œå¦ä¸€ä¸ªæ˜¯å¤±è´¥çš„å›è°ƒ</span>
                        <ul>
                            <li>éƒ½æ˜¯å¯é€‰çš„</li>
                            <li>éƒ½æ˜¯å¦‚æœä¼ å…¥çš„ä¸æ˜¯æ–¹æ³•ï¼Œå†…éƒ¨ä¼šè¢«æ›¿æ¢ä¸ºä¸€ä¸ªæ’ç­‰ï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰å‡½æ•°</li>
                        </ul>
                    </li>
                    <li>è¿”å›å€¼æ˜¯ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼Œæ¥å®ç°é“¾å¼è°ƒç”¨</li>
                    <li>ä¸€ä¸ª Promise å¯ä»¥å¤šæ¬¡è°ƒç”¨ then æ–¹æ³•</li>
                </ul>
            </mark-block>
            <h2>æ‰‹å†™ Promise</h2>
            <p>å°è¯•æ‰‹å†™<line-code>Promise</line-code></p>
            <h3>ES5 å†™æ³•</h3>
            <p>è®©<line-code>ES5</line-code>å†æ¬¡ç„•å‘ç”Ÿæœºï¼Œæ¯•ç«Ÿå’±è¿˜æ˜¯å¿µæ—§çš„æ˜¯å§</p>
            <h4>åˆå§‹å½¢æ€</h4>
            <p><line-code>Promise</line-code>è‚¯å®šæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™éƒ½æ˜¯<line-code>new</line-code>çš„ã€‚å¥½çš„ï¼Œé‚£æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª</p>
            <ul>
                <li>
                    <p>å—¨ï¼Œä½ å¬è¯´äº†å—ï¼Ÿæœ€è¿‘<line-code>Promise</line-code>å¾ˆç«ï¼Œå¥½å¤šäººéƒ½åœ¨ç”¨ä»–ï¼Œå¸‚åœºå‰æ™¯å¹¿é˜”å•Šï¼ğŸ’´ğŸ’´ğŸ’´</p>
                </li>
                <li>
                    <p>çœŸçš„å—ï¼Ÿè¿™ä¸æ˜¯å’±çš„å¼ºé¡¹å˜›ï¼Œæˆ‘å…ˆå¼„ä¸€ä¸ªï¼Œä½ çœ‹çœ‹æ•ˆæœâ€¦â€¦</p>
                </li>
            </ul>
            <p></p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  ç¬¬ä¸€ä¸ªç‰ˆæœ¬
function MyPromise() {}
            </pre>
            <h4>æ„é€ å‡½æ•°</h4>
            <h5>å‚æ•°</h5>
            <p>å½“ä½ <line-code>new Promise</line-code>çš„æ—¶å€™æ˜¯å¦ä¼ é€’å‚æ•°äº†å‘¢ï¼Ÿè‚¯å®šä¼ äº†ï¼Œè¦æ˜¯ä¸ä¼ ï¼Œä¼šæŠ¥é”™çš„ã€‚å¹¶ä¸”è¿˜å¿…é¡»æ˜¯ä¸ª<line-code>function</line-code>ï¼Œä¸ç„¶ä¹Ÿä¼šæŠ¥é”™</p>
            <ul>
                <li>
                    <p>æˆ‘å»ï¼Œä½ å¼„çš„å¤ªæ¾é©°äº†ï¼Œä»€ä¹ˆä¸œè¥¿éƒ½å¯ä»¥å¼„è¿›å»ï¼Œäººå®¶åªå…è®¸<line-code>function</line-code></p>
                </li>
                <li>
                    <p>ğŸ˜…ï¼Œä½ ç¨ç­‰ï¼Œé©¬ä¸Šæ”¯æŒä¸Šâ€¦â€¦</p>
                </li>
            </ul>
            <p>çŸ¥å·±çŸ¥å½¼ï¼Œæ–¹èƒ½ç™¾æˆ˜ç™¾èƒœã€‚è¿˜æ˜¯å…ˆçœ‹çœ‹äººå®¶æ˜¯æ€ä¹ˆå¼„çš„ï¼ŒåŸç”Ÿçš„<line-code>Promise</line-code>æ˜¯è¿™æ ·çš„</p>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹åŸç”Ÿ Promise çš„è¡Œä¸º</summary>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  TypeError: Promise resolver undefined is not a function
var p1 = new Promise();

//  TypeError: Promise resolver 666 is not a function
var p2 = new Promise(666);

//  TypeError: Promise resolver #&lt;Object> is not a function
var p2 = new Promise({name:"666"});
                </pre>
            </details>
            <p>å’±ä»¬çš„æ˜¯è¿™æ ·çš„</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  å¦‚æœä¼ å…¥çš„æ˜¯ {name:"666"} ï¼Œé”™è¯¯ä¿¡æ¯ä¸ä¸€æ ·ã€‚æ¯•ç«Ÿæ˜¯ä»¿é€ çš„ï¼Œå…ˆè¿™æ ·å§ï¼
function MyPromise(executor) {
    if (typeof executor !== "function") throw new TypeError("Promise resolver " + executor + " is not a function");
}
            </pre>
            <mark-block>
                <p>åé¢çš„<line-code>Promise</line-code>å‚æ•°å°±ç”¨<line-code>executor</line-code>ä»£æ›¿äº†ï¼åªè¦æåˆ°<line-code>executor</line-code>ï¼Œå°±è¦æƒ³åˆ°ä»–å°±æ˜¯ä½ <line-code>new Promise</line-code>æ—¶ä¼ è¿›æ¥çš„å®å‚ï¼Œä»–çš„ç±»å‹æ˜¯<line-code>function</line-code></p>
            </mark-block>
            <h5>æ·»åŠ [[PromiseState]]å’Œ[[PromiseResult]]</h5>
            <p>æ—¢ç„¶å¯ä»¥<line-code>new</line-code>æˆåŠŸäº†ï¼Œé‚£æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹ï¼Œä»–çš„å®ä¾‹åˆ°åº•æ˜¯ä¸ªå•¥ï¼</p>
            <ul>
                <li>
                    <p>è¿™æ˜¯ä»€ä¹ˆç©æ„å„¿å•Šï¼äººå®¶<line-code>Promise</line-code>é€ çš„ï¼Œé™¤äº†æœ‰<line-code>[[Prototype]]</line-code>ï¼Œè¿˜æœ‰<line-code>[[PromiseState]]</line-code>å’Œ<line-code>[[PromiseResult]]</line-code>ï¼Œä½ çš„å°±åªæœ‰<line-code>[[Prototype]]</line-code>ï¼Œä½ è¿™ç¼ºæ–¤å°‘ä¸¤çš„ï¼Œä¸è¡Œï¼Œä¸è¡Œï¼Œæˆ‘è¦é€€è´§ã€‚</p>
                </li>
                <li>
                    <p>äº²çˆ±çš„ä¸Šå¸ï¼Œæ‚¨åˆ«æ€¥ï¼Œå’±ä»¬çš„æ¯•ç«Ÿæ˜¯ä¼ªé€ çš„ï¼Œä½†æ˜¯ç»ˆç©¶ç‰©ç¾ä»·å»‰ä¸æ˜¯ï¼Œ<line-code>[[PromiseState]]</line-code>å’Œ<line-code>[[PromiseResult]]</line-code>æˆ‘ä»¬æ˜¯é€ ä¸å‡ºæ¥ï¼Œå°é”æ¯”è¾ƒä¸¥é‡ï¼Œä½ æ‡‚çš„ï¼Œä½†æ˜¯å¯ä»¥ç»™ä½ <line-code>PromiseState</line-code>å’Œ<line-code>PromiseResult</line-code>è¿™ä¸€å¯¹å„¿ï¼Œè™½ç„¶å¤–å½¢æœ‰ç‚¹å·®å¼‚ï¼Œä½†æ˜¯æˆ‘ä¿è¯ï¼Œä»–ä»¬çš„å†…åœ¨ç»å¯¹æ˜¯ä¸€æ ·çš„ï¼Œä½ å°±æ”¾å¿ƒç”¨å§</p>
                </li>
            </ul>
            <p>çœŸä¸å®¹æ˜“å•Šï¼Œè¿˜æ˜¯å¾—å…ˆçœ‹çœ‹äººå®¶çš„ã€‚åŸç”Ÿçš„<line-code>Promise</line-code>æ˜¯è¿™æ ·çš„</p>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹åŸç”Ÿ Promise çš„è¡Œä¸º</summary>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
new Promise(()=>{})
                </pre>
                <p>è¯·çœ‹æ­£ç‰ˆçš„è¾“å‡ºç»“æœ</p>
                <p>
                    <img src="./image/my-001.png" alt="æ§åˆ¶å°æŸ¥çœ‹ Promise å®ä¾‹" />
                </p>
            </details>
            <p>å’±ä»¬çš„æ˜¯è¿™æ ·çš„ï¼Œæ‚¨æ”¾å¿ƒç»å¯¹ä¸å½±å“ä½ ä½¿ç”¨ï¼Œå¹¶ä¸”ç»ˆèº«è´¨ä¿</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function MyPromise(executor) {
    if (typeof executor !== "function") throw new TypeError("Promise resolver " + executor + " is not a function");

    this.PromiseState = "pending";
    this.PromiseResult = undefined;
}
            </pre>
            <h5>ç«‹å³åŒæ­¥æ‰§è¡Œ executor</h5>
            <p>å’±å…ˆå¯¹ä¸€ä¸‹æš—å·ï¼Œ<line-code>executor</line-code>æ˜¯å•¥ï¼Ÿå¯¹ï¼Œä»–å°±æ˜¯ä½ <line-code>new Promise</line-code>æ—¶ä¼ è¿›æ¥çš„å®å‚ï¼Œå¹¶ä¸”æ˜¯ä¸ªæ–¹æ³•</p>
            <ul>
                <li>
                    <p>ä¸è¡Œï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œäººå®¶çš„åªè¦ä¸€<line-code>new</line-code>ï¼Œå°±ä¼šç»™æˆ‘åé¦ˆï¼Œä½ è¿™ä¸è¡Œå•Šï¼Œæˆ‘éƒ½è¯•äº†å¥½å¤šæ¬¡äº†</p>
                </li>
                <li>
                    <p>æ‚¨å…ˆåˆ«ç€æ€¥ï¼Œæˆ‘ç»™æ‚¨çœ‹çœ‹â€¦â€¦</p>
                </li>
            </ul>
            <p>çœŸä¸èƒ½å·æ‡’å•Šï¼Œè¿˜å¾—çœ‹çœ‹äººå®¶çš„ã€‚åŸç”Ÿçš„<line-code>Promise</line-code>æ˜¯è¿™æ ·çš„</p>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹åŸç”Ÿ Promise çš„è¡Œä¸º</summary>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  ä½ å¯ä»¥çœ‹çœ‹è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ
function executor() {
    console.log(1);
}
new Promise(executor);
console.log(2);
                </pre>
            </details>
            <p>å’±ä»¬çš„æ˜¯è¿™æ ·çš„</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  å’±ä¹Ÿå¾—å®‰æ’ä¸Šï¼Œæ—¢ç„¶ä½ ç»™äº†æˆ‘ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£æˆ‘å°±é©¬ä¸Šè°ƒç”¨ï¼Œç»ä¸è¿Ÿç–‘
function MyPromise(executor) {
    if (typeof executor !== "function") throw new TypeError("Promise resolver " + executor + " is not a function");

    this.PromiseState = "pending";
    this.PromiseResult = undefined;

    executor();
}
            </pre>
            <h5>executor çš„å‚æ•°</h5>
            <p>åœ¨<line-code>Promise</line-code>å†…éƒ¨è°ƒç”¨<line-code>executor</line-code>æ–¹æ³•æ—¶ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°å¹¶ä¸”éƒ½æ˜¯æ–¹æ³•</p>
            <ul>
                <li>
                    <p>å“ï¼Œå“ï¼Œå“ï¼Œä¸å¯¹å‘€ï¼æˆ‘è®°å¾—äººå®¶çš„<line-code>Promise</line-code>è°ƒç”¨<line-code>executor</line-code>æ—¶ä¼ ç»™äº†æˆ‘ä¸¤ä¸ªå‚æ•°å‘¢ï¼Œä½ å’‹æ²¡æœ‰å•Šã€‚èƒ½ä¸èƒ½è¡Œäº†ï¼Œå¿«ç‚¹å•Šï¼Œè¦ä¸é€€è´§äº†å•Š</p>
                </li>
                <li>
                    <p>æ‚¨åˆ«æ€¥å•Šï¼Œå…ˆæ¶ˆæ¶ˆæ°”å„¿ï¼Œé©¬ä¸Šç»™æ‚¨å®‰æ’</p>
                </li>
            </ul>
            <p>åŸç”Ÿçš„<line-code>Promise</line-code>æ˜¯è¿™æ ·çš„</p>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹åŸç”Ÿ Promise çš„è¡Œä¸º</summary>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function executor() {
    console.log("å‚æ•°é•¿åº¦ï¼š", arguments.length);
    for (var i = 0; i &lt; arguments.length; i++) {
        console.log("ç¬¬" + (i + 1) + "ä¸ªå‚æ•°çš„ç±»å‹ï¼š", typeof arguments[i]);
    }
}
new Promise(executor);
                </pre>
            </details>
            <p>å’±ä»¬çš„æ˜¯è¿™æ ·çš„</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  å’±ä¹Ÿå¾—å®‰æ’ä¸Šï¼Œä½ ç»™äº†æˆ‘ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£æˆ‘å°±ç»™ä½ ä¸¤ä¸ª
function MyPromise(executor) {
    if (typeof executor !== "function") throw new TypeError("Promise resolver " + executor + " is not a function");

    this.PromiseState = "pending";
    this.PromiseResult = undefined;

    function resolve() {}
    function reject() {}

    executor(resolve, reject);
}
            </pre>
            <h5>ä¿®æ”¹[[PromiseState]]å’Œ[[PromiseResult]]</h5>
            <p>æ‰§è¡Œ<line-code>executor</line-code>æ—¶ä¼ å…¥çš„ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯ä¿®æ”¹<line-code>[[PromiseState]]</line-code>å’Œ<line-code>[[PromiseResult]]</line-code>ç”¨çš„</p>
            <ul>
                <li>ä½ ä¸èƒ½è¿™æ ·å•Šï¼Œä½ ç»™æˆ‘çš„ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯æ‘†è®¾å•Šï¼Œæˆ‘è¯•äº†å¥½å‡ æ¬¡äº†ï¼Œæ²¡ååº”å•Šï¼Œä½ åœ¨è¿™å„¿ç³Šå¼„é¬¼å‘¢ã€‚ä½ çœ‹çœ‹äººå®¶<line-code>Promise</line-code>ï¼Œåªè¦ä¸€æŒ‰ä¸‹<line-code>resolve</line-code>ï¼Œ<line-code>[[PromiseState]]</line-code>å°±å˜æˆäº†"fulfilled"ï¼Œè¿˜æœ‰å‘¢ï¼Œ<line-code>[[PromiseResult]]</line-code>è¿˜èƒ½æ˜¾ç¤ºæˆ‘ä½¿äº†å¤šå¤§åŠ²å„¿ï¼Œå¤šç¥å¥‡å•Š</li>
                <li>å°Šæ•¬çš„ç”¨æˆ·ï¼Œä½ åƒä¸‡åˆ«æ€¥ï¼Œæˆ‘é©¬ä¸Šä¸ºæ‚¨ä¿®å¤ï¼ˆç»ˆäºçŸ¥é“é‚£ä¿©æ–¹æ³•æ˜¯å¹²å•¥çš„äº†ï¼‰</li>
            </ul>
            <p>åŸç”Ÿçš„<line-code>Promise</line-code>æ˜¯è¿™æ ·çš„</p>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹åŸç”Ÿ Promise çš„è¡Œä¸º</summary>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  æˆåŠŸç¤ºä¾‹ 1
function executor1(resolve, reject) {
    resolve();
}
new Promise(executor1);
//  æˆåŠŸç¤ºä¾‹ 2
function executor2(resolve, reject) {
    resolve(666, true, { name: "xiaodu114" });
}
new Promise(executor2);
//  å¤±è´¥ç¤ºä¾‹ 1
function executor3(resolve, reject) {
    reject();
}
new Promise(executor3);
//  å¤±è´¥ç¤ºä¾‹ 2
function executor4(resolve, reject) {
    reject(777, false, { name: "a2bei4" });
}
new Promise(executor4);
                </pre>
            </details>
            <p>å’±ä»¬çš„æ˜¯è¿™æ ·çš„</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function MyPromise(executor) {
    if (typeof executor !== "function") throw new TypeError("Promise resolver " + executor + " is not a function");

    this.PromiseState = "pending";
    this.PromiseResult = undefined;

    var resolve = function (data) {
        this.PromiseResult = data;
        this.PromiseState = "fulfilled";
    }.bind(this);
    var reject = function (error) {
        this.PromiseResult = error;
        this.PromiseState = "rejected";
    }.bind(this);

    executor(resolve, reject);
}
            </pre>
            <h5>[[PromiseState]]å’Œ[[PromiseResult]]åªèƒ½ä¿®æ”¹ä¸€æ¬¡</h5>
            <p><line-code>Promise</line-code>è¿˜æ˜¯å¾ˆä¸“ä¸€çš„ï¼Œåªè¦ç¡®å®šäº†ä¸€ä¸ªï¼Œå°±ä¸ä¼šæ”¹å˜äº†ã€‚<line-code>[[PromiseState]]</line-code>åªèƒ½ç”±<line-code>pending</line-code>åˆ°<line-code>fulfilled</line-code>æˆ–è€…ç”±<line-code>pending</line-code>åˆ°<line-code>rejected</line-code></p>
            <ul>
                <li>
                    <p>å“ï¼Œå“ï¼Œå“ï¼Œä½ çœ‹çœ‹äººå®¶<line-code>Promise</line-code>ï¼Œåªèƒ½æ˜¯<line-code>pending</line-code>å¼€å§‹ï¼Œè¦ä¹ˆ<line-code>fulfilled</line-code>ï¼Œè¦ä¹ˆ<line-code>rejected</line-code>ã€‚ä½ åˆ«æ€»æ˜¯é‚£ä¹ˆæ¾å¼›ï¼Œå’±ä¸æ˜¯åº”è¯¥å…ˆå…¥ä¸ºä¸»ï¼Œä»ä¸€è€Œç»ˆå˜›ï¼ä½ ä¸èƒ½ä¹±æ¥å•Š</p>
                </li>
                <li>
                    <p>ğŸ˜…ï¼Œå’±ä¹Ÿä¸æ˜¯é‚£äººå•Šï¼Œé©¬ä¸Šç»™æ‚¨è§£å†³ï¼Œè™½ç„¶è´¨é‡æ˜¯å·®äº†ç‚¹ï¼Œä½†æ˜¯å’±ä»¬çš„æœåŠ¡æ˜¯åˆšåˆšâ€¦â€¦</p>
                </li>
            </ul>
            <p>åŸç”Ÿçš„<line-code>Promise</line-code>æ˜¯è¿™æ ·çš„</p>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹åŸç”Ÿ Promise çš„è¡Œä¸º</summary>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  ç¤ºä¾‹ 1
function executor1(resolve, reject) {
    resolve(666);
    resolve(888);
}
new Promise(executor1);
//  ç¤ºä¾‹ 2
function executor2(resolve, reject) {
    reject(555);
    reject(777);
}
new Promise(executor2);
//  ç¤ºä¾‹ 3
function executor3(resolve, reject) {
    resolve(666);
    reject(555);
}
new Promise(executor3);
//  ç¤ºä¾‹ 4
function executor4(resolve, reject) {
    reject(777);
    resolve(888);
}
new Promise(executor4);
                </pre>
            </details>
            <p>å’±ä»¬çš„æ˜¯è¿™æ ·çš„</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function MyPromise(executor) {
    if (typeof executor !== "function") throw new TypeError("Promise resolver " + executor + " is not a function");

    this.PromiseState = "pending";
    this.PromiseResult = undefined;

    var resolve = function (data) {
        if (this.PromiseState !== "pending") return;
        this.PromiseResult = data;
        this.PromiseState = "fulfilled";
    }.bind(this);

    var reject = function (error) {
        if (this.PromiseState !== "pending") return;
        this.PromiseResult = error;
        this.PromiseState = "rejected";
    }.bind(this);

    executor(resolve, reject);
}
            </pre>
            <h5>executor ä¸­å‡ºç°å¼‚å¸¸</h5>
            <p>ä½ åˆ«è¯´<line-code>Promise</line-code>è¿˜æ˜¯å¾ˆä¸¥è°¨çš„ï¼Œè€ƒè™‘çš„æ¯”è¾ƒå…¨é¢ï¼Œæ¯”å¦‚ï¼šæ‰§è¡Œ<line-code>executor</line-code>æ—¶æŠ¥é”™äº†æ€ä¹ˆåŠï¼Œäººå®¶<line-code>try catch</line-code>äº†</p>
            <ul>
                <li>
                    <p>éƒ½ç»™ä½ è¯´äº†å¥½å‡ éäº†ï¼Œä½ å°±æ˜¯å¤ªæ¾é©°äº†ï¼Œä½ è¿˜ä¸ä¿¡ï¼Œä½ çœ‹çœ‹äººå®¶<line-code>Promise</line-code>æ‰§è¡Œæˆ‘ä¼ å…¥çš„<line-code>executor</line-code>æ—¶ç›‘å¬å¼‚å¸¸äº†ï¼Œä½ çš„å°±æ²¡æœ‰ï¼ŒçœŸæ˜¯å¤ªæ¾é©°äº†</p>
                </li>
                <li>
                    <p>ï¼ˆæ€ä¹ˆåˆå‡ºé—®é¢˜äº†ï¼Œè¾›äºæ˜¯ä¸ªå°é—®é¢˜ï¼‰å¥½æ»´ï¼Œå¥½æ»´ï¼Œé©¬ä¸Šç»™æ‚¨è§£å†³ï¼Œä½ å°±æ•¬å¬ä½³éŸ³å§ï¼</p>
                </li>
            </ul>
            <p>åŸç”Ÿçš„<line-code>Promise</line-code>æ˜¯è¿™æ ·çš„</p>
            <details>
                <summary>ç‚¹å‡»æŸ¥çœ‹åŸç”Ÿ Promise çš„è¡Œä¸º</summary>
                <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function executor1(resolve, reject) {
    console.log(a2bei4);
}
new Promise(executor1);
                </pre>
            </details>
            <p>å’±ä»¬çš„æ˜¯è¿™æ ·çš„</p>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function MyPromise(executor) {
    if (typeof executor !== "function") throw new TypeError("Promise resolver " + executor + " is not a function");

    this.PromiseState = "pending";
    this.PromiseResult = undefined;

    var resolve = function (data) {
        if (this.PromiseState !== "pending") return;
        this.PromiseResult = data;
        this.PromiseState = "fulfilled";
    }.bind(this);

    var reject = function (error) {
        if (this.PromiseState !== "pending") return;
        this.PromiseResult = error;
        this.PromiseState = "rejected";
    }.bind(this);

    try {
        executor(resolve, reject);
    } catch (error) {
        reject(error);
    }
}
            </pre>
            <h4>then æ–¹æ³•</h4>
            <p>æ•¬è¯·æœŸå¾…</p>
        </div>
    </body>
</html>
