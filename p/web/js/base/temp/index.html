<!DOCTYPE html>
<html lang="zh-cmn-Hans">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>javascript 临时 - xiaodu114.github.io</title>
        <meta name="keywords" content="javascript 基础,原型链属性查找,Generator,new,手写 new,深拷贝" />
        <meta name="description" content="临时记录一些东西" />

        <script src="/p/_/js/main.js"></script>
    </head>

    <body>
        <!-- github访问地址：/p/web/js/base/temp/index.html -->
        <div class="blog-page">
            <h1>JavaScript</h1>
            <p>临时记录一些东西</p>
            <h2>原型链查找属性</h2>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
//  方式一
function getPropertyValue1(target, propertyKey) {
    if (Object.hasOwnProperty.call(target, propertyKey)) return target[propertyKey];
    let proto = Object.getPrototypeOf(target);
    return proto === null ? undefined : getPropertyValue1(proto, propertyKey);
}
//  方式二
function getPropertyValue2(target, propertyKey) {
    if (Object.hasOwnProperty.call(target, propertyKey)) return target[propertyKey];
    let proto = Object.getPrototypeOf(target);
    while (proto !== null) {
        if (Object.hasOwnProperty.call(proto, propertyKey)) return proto[propertyKey];
        proto = Object.getPrototypeOf(proto);
    }
    return undefined;
}

//  测试
let obj = { name: "6666" };
let symbolKey = Symbol("a2bei4");
obj[symbolKey] = "Symbol属性测试";
console.dir(getPropertyValue1(obj, "name"));
console.dir(getPropertyValue1(obj, "qwe"));
console.dir(getPropertyValue1(obj, "toString"));
console.dir(getPropertyValue1(obj, "obj1"));
console.dir(getPropertyValue1(obj, symbolKey));
console.dir(getPropertyValue1(obj, Symbol("a2bei4")));
console.log("-----------------------------------------------");
console.dir(getPropertyValue2(obj, "name"));
console.dir(getPropertyValue2(obj, "qwe"));
console.dir(getPropertyValue2(obj, "toString"));
console.dir(getPropertyValue2(obj, "obj1"));
console.dir(getPropertyValue2(obj, symbolKey));
console.dir(getPropertyValue2(obj, Symbol("a2bei4")));
            </pre>
            <h2>手写 new</h2>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function myNew(fn, ...args) {
    //  判断 fn 是一个构造器
    //      1、箭头函数 类型是 function，但是没有 prototype 属性
    //      2、生成器函数 类型是 function，有 prototype 属性，但是 fn.prototype.constructor 并不等于他自身
    if (!(typeof fn === "function" && fn.hasOwnProperty("prototype") && fn.prototype.constructor === fn)) throw new TypeError("fn is not a constructor");
    let obj = Object.create(fn.prototype);
    let ret = fn.apply(obj, args);
    //  new 一个构造函数时，如果构造函数有返回值，那么支持哪些类型？？？
    if (ret !== null && (typeof ret === "object" || typeof ret === "function")) return ret;
    return obj;
}
            </pre>
            <h2>执行一个生成器函数</h2>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function* fn() {
    let res1 = yield Promise.resolve(1);
    console.log(res1);
    let res2 = yield Promise.resolve(2);
    console.log(res2);
    let res3 = yield Promise.resolve(3);
    console.log(res3);
    let res4 = yield Promise.reject(4);
    console.log(res4);
    let res5 = yield Promise.resolve(5);
    console.log(res5);
}

function runGenerator(generator) {
    let gen = generator();
    function next(data) {
        let { done, value } = gen.next(data);
        if (done) return;
        //  简写
        //  value.then(next).catch(next);
        value
            .then((data2) => {
                next(data2);
            })
            .catch((error) => {
                next(error);
            });
    }
    next();
}

runGenerator(fn);                
            </pre>
            <h2>深拷贝</h2>
            <pre ddz-class="here-need-to-handle-by-highlight" ddz-lang="javascript">
function deepClone(target, weakMap = new WeakMap()) {
    if (typeof target !== "object") return target;

    //  处理一些特殊的对象类型，例如：null Date RegExp Map Set Symbol Function
    if (target === null) return target;

    //  处理正常对象和数组
    if (weakMap.has(target)) {
        return weakMap.get(target);
    }
    let cloneTarget = Array.isArray(target) ? [] : {};
    weakMap.set(target, cloneTarget);
    for (const key in target) {
        if (Object.prototype.hasOwnProperty.call(target, key)) {
            cloneTarget[key] = deepClone(target[key], weakMap);
        }
    }
    return cloneTarget;
}

//  测试
var objTest1 = {
    name: "xiadu114",
    age: 18,
    langs: ["c#", "javascript", "html", "css"],
    obj: {
        a: 1,
        b: {
            b1: 1,
            b2: 2
        }
    }
};

var objTest2 = {
    name: "xiadu114"
};
objTest2.obj = objTest2;

var objTest1_1 = deepClone(objTest1);
console.log(objTest1_1);
var objTest2_1 = deepClone(objTest2);
console.log(objTest2_1);
            </pre>
        </div>
    </body>
</html>
